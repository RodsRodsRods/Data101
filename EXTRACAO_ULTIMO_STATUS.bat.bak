@echo off

rem Defina as variáveis
rem Defina as variáveis
set DB_USER=rodolpho.franzao
set DB_PASSWORD=m7KaLZGaX3k7aER
set DB_HOST=sql-crefaz-bi.database.windows.net
set DB_NAME=db-crefaz-bi
set TABLE_NAME=report.MotorUltimoStatus
set OUTPUT_FOLDER="C:\Users\rodolpho.franzao\Downloads"
set OUTPUT_FILE=%OUTPUT_FOLDER%\motor-ultimo-status.csv
set TEMP_FILE=%OUTPUT_FOLDER%\temp.csv
set COLUMN_HEADER=CPFCNPJ;NOME_CLIENTE;DATA_NASCIMENTO;CIDADE;UF;CEP;TIPO_CLIENTE;TOTAL_PAGAS;OCUPACAO_CLIENTE;CPFCNPJ_AGENTE;AGENTE;USUARIO_AGENTE;UNIDADE_CIDADE;UNIDADE_UF;SUPERVISOR;GERENTE;COORDENADOR;UNIDADE;MATRIZ;COD_PROPOSTA;COD_OPERACAO;PRODUTO;DATA_CADASTRO_PRINCIPAL;DATA_CADASTRO;HORA_CADASTRO;DATA_STATUS;HORA_STATUS;DATA_ALTERACAO;HORA_ALTERACAO;ULTIMO_STATUS;USUARIO_STATUS;DECISAO;DATA_DECISAO;USUARIO_DECISAO;STATUS_ANTERIOR;PROPOSTA_PENDENTE;PENDENTE_DE_CONTATO;DT_AG_ANALISE;DATA_PAGAMENTO;TIPO_PROPOSTA;VLR_CONTRATADO;VLR_PARCELA;PRAZO;TX_CONTRATO;UC_VENDA;CIA_NOME;REANALISE;SITUACAO_CPF;MOTIVO_RECUSA_NEGACAO;RENDA_PRESUMIDA;RENDA_DIGITADA;RENDA_PROMOBANK;DATA_CONSULTA_QUOD;DATA_CONSULTA_BVS;DATA_CONSULTA_SPC;SCORE_BVS;SCORE_SPC;VALOR_QUOD;VALOR_BVS;VALOR_SPC;QNTD_TOTAL_BVS;QNTD_TOTAL_SPC;QNTD_TOTAL_QUOD;QNTD_DOC_SPC;QNTD_CCF_QUOD;QNTD_CCF_BVS;QNTD_CCF_SPC;CANCELADA_EXPIRACAO;CodGeral

rem Exporta os dados para um arquivo temporário
bcp "SELECT * FROM %TABLE_NAME% WITH(NOLOCK)" queryout %TEMP_FILE% -S %DB_HOST% -d %DB_NAME% -U %DB_USER% -P %DB_PASSWORD% -c -t; -C 65001

rem Adiciona manualmente os nomes das colunas no início do arquivo CSV
echo %COLUMN_HEADER% > %OUTPUT_FILE%

rem Concatena o arquivo temporário ao arquivo final
type %TEMP_FILE% >> %OUTPUT_FILE%

rem Remove o arquivo temporário
del %TEMP_FILE%

rem Exibe uma mensagem informando que a exportação foi concluída
echo Exportação para CSV feita com sucesso!

rem Aguarda uma entrada antes de fechar a janela
pause
